<?xml version="1.0" encoding="UTF-8"?>
<aiml version="2.0">
   <category>
        <pattern>^ evento+ ^</pattern>
        <template>
            <think>
                <set name="topic">evento</set>
                <set name="argumento"><star index="1"/> <star index="2"/></set>
            </think>
            <srai>FUNCION_REGLAS_EVENTO <get name="argumento"/></srai>
        </template>
    </category>

<topic name="evento">
    <category>
        <pattern>FUNCION_REGLAS_EVENTO *</pattern>
        <template>
            <think>
                <set var="archivo">agregar</set>
                <set var="aqui"><readset><get var="archivo"/></readset></set>
                <set var="palabra"><srai>ITERATE <star/></srai></set>
            </think>
            <condition var="palabra">
                <li value="#NOENCONTRADO">Esta opcion no esta disponible para los Eventos.</li>
                <li value="$">
                   <condition var="archivo">
                       <li value="agregar">
                            <think>
                                <set var="archivo">modificar</set>
                                <set var="aqui"><readset><get var="archivo"/></readset></set>
                                <set var="palabra"><srai>ITERATE <star/></srai></set>
                            </think>
                       </li>
                       <li value="modificar">
                            <think>
                                <set var="archivo">eliminar</set>
                                <set var="aqui"><readset><get var="archivo"/></readset></set>
                                <set var="palabra"><srai>ITERATE <star/></srai></set>
                            </think>
                       </li>
                       <li value="eliminar">
                            <think>
                                <set var="archivo">listar</set>
                                <set var="aqui"><readset><get var="archivo"/></readset></set>
                                <set var="palabra"><srai>ITERATE <star/></srai></set>
                            </think>
                       </li>
                       <li value="listar">
                            <think>
                                <set var="archivo">tamaño</set>
                                <set var="aqui"><readset><get var="archivo"/></readset></set>
                                <set var="palabra"><srai>ITERATE <star/></srai></set>
                            </think>
                       </li>
                       <li>
                            <think>
                                <set var="palabra">#NOENCONTRADO</set>
                            </think>
                       </li>
                   </condition>
                   <loop/>
                </li>
                <li value="#"><srai>FUNCION_<get var="archivo"/>_EVENTO</srai></li>
                <li>
                    <think>
                        <set var="donde"><srai>FINDITEM <get var="palabra"/> IN <get var="aqui"/></srai></set>
                    </think>
                    <condition var="donde">
                        <li value="0">
                           <think>
                               <set var="palabra"><srai>NEXT</srai></set>
                           </think>
                        </li>
                        <li>
                            <think>
                                <set var="palabra">#</set>
                            </think>
                        </li>
                    </condition>
                    <loop/>
                </li>
            </condition>
        </template>
    </category>
    <!-->Agregar Evento</!-->
    <category>
        <pattern>FUNCION_AGREGAR_EVENTO</pattern>
        <template>
            Ingresa el NOMBRE del EVENTO
        </template>
    </category>
    <category>
        <pattern>*</pattern>
        <that>INGRESA EL NOMBRE DEL EVENTO</that>
        <template>
            <think>
                <set name="nombre_evento"><srai>ponerbarrabaja <star/></srai></set>
            </think>
            Ingresa la FECHA del EVENTO
        </template>
    </category>
    <category>
        <pattern>* de * del *</pattern>
        <that>INGRESA LA FECHA DEL EVENTO</that>
        <template>
            <srai>
                AGREGAR_FECHA_EVENTO <star index="1"/> <map name="fecha_meses"><star index="2"/></map> <star index="3"/>
            </srai>
        </template>
    </category>
    <category>
        <pattern>*</pattern>
        <that>INGRESA LA FECHA DEL EVENTO</that>
        <template>
            <srai>AGREGAR_FECHA_EVENTO <star/></srai>
        </template>
    </category>
    <category>
        <pattern>AGREGAR_FECHA_EVENTO *</pattern>
        <that>INGRESA LA FECHA DEL EVENTO</that>
        <template>
            <think>
               <!-->La fecha se deja en forma 12 10 2017, y despues en validate se revisa que sea valida, y se deja en 12_10_2017</!-->
                <set name="fecha_evento"><srai>quitarespacios <srai>ponerbarrabaja <star/></srai></srai></set>
                <set var="validate"><srai>validarfechacustom <get name="fecha_evento"/></srai></set>
                <condition var="validate">
                    <li value="NO">
                        <set var="resultado">Fecha no valida. Accion cancelada.</set>
                        <set name="topic">unknown</set>
                    </li>
                    <li>
                        <set var="resultado">Ingresa la HORA del EVENTO</set>
                        <set name="fecha_evento"><get var="validate"/></set>
                    </li>
                </condition>
            </think>
            <get var="resultado"/>
        </template>
    </category>
    <category>
        <pattern>*</pattern>
        <that>INGRESA LA HORA DEL EVENTO</that>
        <template>
            <think>
               <!-->Se revisa que la hora sea valida, y se crea el evento</!-->
                <set name="hora_evento"><srai>ponerbarrabaja <srai>quitarespacios <star/></srai></srai></set>
                <set name="pos_hora">
                    <map name="fecha_horas">
                        <get name="hora_evento"/>
                    </map>
                </set>
                <condition name="pos_hora">
                    <li value="unknown">
                        <set var="resultado">Hora invalida. Accion cancelada.</set>
                        <set name="topic">unknown</set>
                    </li>
                    <li>
                        <set var="creado"><map name="evento"><get name="fecha_evento"/></map></set>
                        <set var="listado">null null null null null null null null null null null null null null null null null null null null null null null null null null null null null null null null null null null null null null null null null null null null null null null null</set>
                        <!-->Se revisa si la fecha ya esta creada</!-->
                        <condition var="creado">
                            <li value="unknown">
                                <addtomap>
                                    <name>evento</name>
                                    <key><get name="fecha_evento"/></key>
                                    <value><get var="listado"/></value>
                                </addtomap>
                            </li>
                            <li>
                                <set var="listado"><get var="creado"/></set>
                            </li>
                        </condition>
                        <set var="creado">
                            <srai>SELECTITEM <get name="pos_hora"/> IN <get var="listado"/></srai>
                        </set>
                        <condition var="creado">
                            <li value="null">
                                <!-->Se actualiza el archivo en la posicion de la hora si es que no habia un evento, y se coloca el nombre del evento</!-->
                                <set var="listado">
                                    <srai>CHANGEITEM <get name="pos_hora"/> BY <get name="nombre_evento"/> IN <get var="listado"/></srai>
                                </set>
                                <modifymap>
                                    <name>evento</name>
                                    <key><get name="fecha_evento"/></key>
                                    <value><get var="listado"/></value>
                                </modifymap>
                                <addtomap>
                                    <name>evento_persona</name>
                                    <key><get name="fecha_evento"/>_<get name="hora_evento"/></key>
                                    <value></value>
                                </addtomap>
                                <set var="resultado">Quieres asociar un contacto al evento</set>
                            </li>
                            <li>
                                <set var="resultado">Ya existe un evento a esa hora en este dia.</set>
                                <set name="topic">unknown</set>
                            </li>
                        </condition>

                    </li>
                </condition>
            </think>
            <get var="resultado"/>
        </template>
    </category>
    <category>
        <pattern>^ [No Nunca] ^</pattern>
        <that>QUIERES ASOCIAR UN (NUEVO) CONTACTO AL EVENTO</that>
        <template>
            Perfecto.
            <think>
                <set name="topic">unknown</set>
            </think>
        </template>
    </category>
    <category>
        <pattern>^ [Si claro ok] ^</pattern>
        <that>QUIERES ASOCIAR UN (NUEVO) CONTACTO AL EVENTO</that>
        <template>
            Quien es el contacto
        </template>
    </category>
    <category>
        <pattern>*</pattern>
        <that>QUIEN ES EL CONTACTO</that>
        <template>
            <srai>AGREGAR UN NUEVO CONTACTO AL EVENTO <star/></srai>
        </template>
    </category>
    <category>
        <pattern>AGREGAR UN NUEVO CONTACTO AL EVENTO *</pattern>
        <template>
            <think>
                <set var="a"><star/></set>
                <condition var="a">
                   <li value="NORESP">
                       <set var="resultado">Error. El apellido ingresado no es valido</set>
                        <set name="topic">unknown</set>
                   </li>
                   <li>
                        <set var="nombre"><map name="contacto_nombre"><srai>ponerbarrabaja <star/></srai></map></set>
                       <condition var="nombre">
                           <li value="unknown"> <!-->unknown significa que no existe en el map</!-->
                                <set var="resultado">El contacto no existe en la agenda.</set>
                                <set name="topic">unknown</set>
                           </li>
                           <li>
                                <set var="apellido"><srai>ponerbarrabaja <star/></srai></set>
                                <set var="contactos_en_evento">
                                    <map name="evento_persona"><get name="fecha_evento"/>_<get name="hora_evento"/></map>
                                </set>
                                <!-->contador para cuando no hay contactos en evento</!-->
                                <set var="contador">
                                    <srai>COUNT <get var="contactos_en_evento"/></srai>
                                </set>
                                <condition var="contador">
                                    <li value="0">
                                        <set var="encontrado">0</set>
                                    </li>
                                    <li>
                                       <!-->Si no esta vacio, se busca si ya esta el contacto</!-->
                                        <set var="encontrado">
                                            <srai>FINDITEM <get var="apellido"/> IN <get var="contactos_en_evento"/></srai>
                                        </set>
                                    </li>
                                </condition>
                                <condition var="encontrado">
                                    <li value="0">
                                       <!-->Si no esta, se agrega</!-->
                                        <modifymap>
                                            <name>evento_persona</name>
                                            <key><get name="fecha_evento"/>_<get name="hora_evento"/></key>
                                            <value><get var="contactos_en_evento"/> <get var="apellido"/></value>
                                        </modifymap>
                                        <set var="resultado">Quieres asociar un nuevo contacto al evento</set>
                                    </li>
                                    <li>
                                        <set var="resultado">El contacto ya se encuentra en el evento.</set>
                                        <set name="topic">unknown</set>
                                    </li>
                                </condition>

                           </li>
                       </condition>
                   </li>
                </condition>
            </think>
            <get var="resultado"/>
        </template>
    </category>
    <!-->Listar Evento</!-->
    <category>
        <pattern>FUNCION_LISTAR_EVENTO</pattern>
        <template><srai>FUNCION_LISTAR_EVENTO2 <get name="argumento"/></srai></template>
    </category>
    <category>
       <!-->EJ: que eventos tengo el dia 20 de mayo del 2017</!-->
        <pattern>FUNCION_LISTAR_EVENTO2 ^ dia * de * del *</pattern>
        <template>
            <srai>
                FUNCION_LISTAR_EVENTO2 dia <star index="2"/> <map name="fecha_meses"><star index="3"/></map> <star index="4"/>
            </srai>
        </template>
    </category>
    <category>
        <pattern>FUNCION_LISTAR_EVENTO2 ^ dia *</pattern>
        <template>
            <think>
               <!-->La fecha se deja en forma 12 10 2017, y despues en validate se revisa que sea valida, y se deja en 12_10_2017</!-->
                <set var="fecha_evento"><srai>quitarespacios <srai>ponerbarrabaja <star index="2"/></srai></srai></set>
                <set var="validate"><srai>validarfechacustom <get var="fecha_evento"/></srai></set>
                <condition var="validate">
                    <li value="NO">
                        <set var="resultado">Fecha no valida. Accion cancelada.</set>
                    </li>
                    <li>
                        <set var="fecha_evento"><get var="validate"/></set>
                        <set var="evento"><srai>ITERATE <map name="evento"><get var="fecha_evento"/></map></srai></set>
                        <set var="resultado"></set>
                        <set var="flag">FALSE</set>
                        <condition var="evento">
                            <li value="$"></li>
                            <li value="unknown"></li>
                            <li value="null">
                                <set var="evento"><srai>NEXT</srai></set>
                                <loop/>
                            </li>
                            <li>
                                <set var="flag">TRUE</set>
                                <set var="resultado"><get var="resultado"/> , <srai>quitarespacios <get var="evento"/></srai></set>
                                <set var="evento"><srai>NEXT</srai></set>
                                <loop/>
                            </li>
                        </condition>

                        <condition var="flag">
                            <li value="FALSE">
                                <set var="resultado">No hay eventos este dia.</set>
                            </li>
                            <li value="TRUE">
                                <!-->Quito la primera coma</!-->
                                <set var="resultado">Tus eventos son: <srai>REMOVEITEM 1 IN <get var="resultado"/></srai></set>
                            </li>
                        </condition>
                    </li>
                </condition>
                <set name="topic">unknown</set>
            </think>
            <get var="resultado"/>
        </template>
    </category>
    <!-->Tamaño Eventos</!-->
    <category>
        <pattern>FUNCION_TAMAÑO_EVENTO</pattern>
        <template><srai>FUNCION_TAMAÑO_EVENTO2 <get name="argumento"/></srai></template>
    </category>
    <category>
       <!-->EJ: que eventos tengo el dia 20 de mayo del 2017</!-->
        <pattern>FUNCION_TAMAÑO_EVENTO2 ^ dia * de * del *</pattern>
        <template>
            <srai>
                FUNCION_TAMAÑO_EVENTO2 dia <star index="2"/> <map name="fecha_meses"><star index="3"/></map> <star index="4"/>
            </srai>
        </template>
    </category>
    <category>
        <pattern>FUNCION_TAMAÑO_EVENTO2 ^ dia *</pattern>
        <template>
            <think>
               <!-->La fecha se deja en forma 12 10 2017, y despues en validate se revisa que sea valida, y se deja en 12_10_2017</!-->
                <set var="fecha_evento"><srai>quitarespacios <srai>ponerbarrabaja <star index="2"/></srai></srai></set>
                <set var="validate"><srai>validarfechacustom <get var="fecha_evento"/></srai></set>
                <condition var="validate">
                    <li value="NO">
                        <set var="resultado">Fecha no valida. Accion cancelada.</set>
                    </li>
                    <li>
                        <set var="fecha_evento"><get var="validate"/></set>
                        <set var="evento"><srai>ITERATE <map name="evento"><get var="fecha_evento"/></map></srai></set>
                        <set var="resultado"></set>
                        <set var="flag">FALSE</set>
                        <condition var="evento">
                            <li value="$"></li>
                            <li value="unknown"></li>
                            <li value="null">
                                <set var="evento"><srai>NEXT</srai></set>
                                <loop/>
                            </li>
                            <li>
                                <set var="flag">TRUE</set>
                                <set var="resultado"><get var="resultado"/> <get var="evento"/></set>
                                <set var="evento"><srai>NEXT</srai></set>
                                <loop/>
                            </li>
                        </condition>

                        <condition var="flag">
                            <li value="FALSE">
                                <set var="resultado">No hay eventos este dia.</set>
                            </li>
                            <li value="TRUE">
                                <set var="resultado">Tienes <srai>COUNT <get var="resultado"/></srai> Eventos ese dia.</set>
                            </li>
                        </condition>
                    </li>
                </condition>
                <set name="topic">unknown</set>
            </think>
            <get var="resultado"/>
        </template>
    </category>
    <!-->Modificar Evento</!-->
    <category>
        <pattern>FUNCION_MODIFICAR_EVENTO</pattern>
        <template>Indica la fecha del evento</template>
    </category>
    <category>
        <pattern>* de * del *</pattern>
        <that>INDICA LA FECHA DEL EVENTO</that>
        <template>
            <srai>
                MODIFICAR_VERIFICAR <star index="1"/> <map name="fecha_meses"><star index="2"/></map> <star index="3"/>
            </srai>
        </template>
    </category>
    <category>
        <pattern>*</pattern>
        <that>INDICA LA FECHA DEL EVENTO</that>
        <template><srai>MODIFICAR_VERIFICAR <star/></srai></template>
    </category>
    <category>
        <pattern>MODIFICAR_VERIFICAR *</pattern>
        <that>INDICA LA FECHA DEL EVENTO</that>
        <template>
            <think>
               <!-->La fecha se deja en forma 12 10 2017, y despues en validate se revisa que sea valida, y se deja en 12_10_2017</!-->
                <set name="fecha_evento"><srai>quitarespacios <srai>ponerbarrabaja <star/></srai></srai></set>
                <set var="validate"><srai>validarfechacustom <get name="fecha_evento"/></srai></set>
                <condition var="validate">
                    <li value="NO">
                        <set var="resultado">Fecha no valida. Accion cancelada.</set>
                        <set name="topic">unknown</set>
                    </li>
                    <li>
                        <set name="fecha_evento"><get var="validate"/></set>
                        <set var="eventos"><map name="evento"><get name="fecha_evento"/></map></set>
                        <!-->Se verifica si existe la key en esta fecha</!-->
                        <condition var="eventos">
                            <li value="unknown">
                                <set var="resultado">No existen eventos en esta fecha</set>
                                <set name="topic">unknown</set>
                            </li>
                            <li>
                                <set var="resultado">Ingresa la hora</set>
                            </li>
                        </condition>
                    </li>
                </condition>
            </think>
            <get var="resultado"/>
        </template>
    </category>
    <category>
        <pattern>*</pattern>
        <that>INGRESA LA HORA</that>
        <template>
            <think>
               <!-->Se revisa que la hora sea valida</!-->
                <set name="hora_evento"><srai>ponerbarrabaja <srai>quitarespacios <star/></srai></srai></set>
                <set name="pos_hora">
                    <map name="fecha_horas">
                        <get name="hora_evento"/>
                    </map>
                </set>
                <condition name="pos_hora">
                    <li value="unknown">
                        <set var="resultado">Hora invalida. Accion cancelada.</set>
                        <set name="topic">unknown</set>
                    </li>
                    <li>
                        <set var="listado"><map name="evento"><get name="fecha_evento"/></map></set>
                        <set var="evento">
                            <srai>SELECTITEM <get name="pos_hora"/> IN <get var="listado"/></srai>
                        </set>
                        <condition var="evento">
                            <li value="null">
                                <set var="resultado">No existe un evento a esta hora en la fecha indicada</set>
                                <set name="topic">unknown</set>
                            </li>
                            <li>
                                <set var="resultado">Desea modificar el titulo, la fecha, la hora, o un contacto</set>
                            </li>
                        </condition>
                    </li>
               </condition>
            </think>
            <get var="resultado"/>
        </template>
    </category>
    <!-->Modificar titulo</!-->
    <category>
        <pattern>^ titulo ^</pattern>
        <that>DESEA MODIFICAR EL TITULO, LA FECHA, LA HORA, O UN CONTACTO</that>
        <template>Ingresa el nuevo titulo</template>
    </category>
    <category>
        <pattern>*</pattern>
        <that>INGRESA EL NUEVO TITULO</that>
        <template>
            <think>
                <set var="eventos"><map name="evento"><get name="fecha_evento"/></map></set>
                <set var="edit">
                    <srai>CHANGEITEM <get name="pos_hora"/> BY <srai>ponerbarrabaja <star/></srai> IN <get var="eventos"/></srai>
                </set>

                <modifymap>
                    <name>evento</name>
                    <key><get name="fecha_evento"/></key>
                    <value><get var="edit"/></value>
                </modifymap>
                <set var="resultado">Evento modificado correctamente</set>
                <set name="topic">unknown</set>
            </think>
            <get var="resultado"/>
        </template>
    </category>
    <!-->Modificar fecha</!-->
    <category>
        <pattern>^ fecha ^</pattern>
        <that>DESEA MODIFICAR EL TITULO, LA FECHA, LA HORA, O UN CONTACTO</that>
        <template>Ingresa la nueva fecha</template>
    </category>
    <category>
        <pattern>* de * del *</pattern>
        <that>INGRESA LA NUEVA FECHA</that>
        <template>
            <srai>
                MODIFICAR_VERIFICAR2 <star index="1"/> <map name="fecha_meses"><star index="2"/></map> <star index="3"/>
            </srai>
        </template>
    </category>
    <category>
        <pattern>*</pattern>
        <that>INGRESA LA NUEVA FECHA</that>
        <template><srai>MODIFICAR_VERIFICAR2 <star/></srai></template>
    </category>
    <category>
        <pattern>MODIFICAR_VERIFICAR2 *</pattern>
        <that>INGRESA LA NUEVA FECHA</that>
        <template>
            <think>
               <!-->La fecha se deja en forma 12 10 2017, y despues en validate se revisa que sea valida, y se deja en 12_10_2017</!-->
                <set var="fecha_evento_nuevo"><srai>quitarespacios <srai>ponerbarrabaja <star/></srai></srai></set>
                <set var="validate"><srai>validarfechacustom <get var="fecha_evento_nuevo"/></srai></set>
                <condition var="validate">
                    <li value="NO">
                        <set var="resultado">Fecha no valida. Accion cancelada.</set>
                        <set name="topic">unknown</set>
                    </li>
                    <li>
                        <set var="fecha_evento_nuevo"><get var="validate"/></set>
                        <set var="creado"><map name="evento"><get var="fecha_evento_nuevo"/></map></set>
                        <set var="listado">null null null null null null null null null null null null null null null null null null null null null null null null null null null null null null null null null null null null null null null null null null null null null null null null</set>
                        <!-->Se revisa si la fecha ya esta creada</!-->
                        <condition var="creado">
                            <li value="unknown">
                                <addtomap>
                                    <name>evento</name>
                                    <key><get var="fecha_evento_nuevo"/></key>
                                    <value><get var="listado"/></value>
                                </addtomap>
                            </li>
                            <li>
                                <set var="listado"><get var="creado"/></set>
                            </li>
                        </condition>
                        <set var="creado">
                            <srai>SELECTITEM <get name="pos_hora"/> IN <get var="listado"/></srai>
                        </set>
                        <condition var="creado">
                            <li value="null">
                                <set name="nombre_evento">
                                    <srai>SELECTITEM <get name="pos_hora"/> IN <map name="evento"><get name="fecha_evento"/></map></srai>
                                </set>
                                <!-->Se actualiza la nueva fecha</!-->
                                <set var="listado_nuevo">
                                    <srai>CHANGEITEM <get name="pos_hora"/> BY <get name="nombre_evento"/> IN <get var="listado"/></srai>
                                </set>
                                <modifymap>
                                    <name>evento</name>
                                    <key><get var="fecha_evento_nuevo"/></key>
                                    <value><get var="listado_nuevo"/></value>
                                </modifymap>
                                <set var="contactos">
                                    <map name="evento_persona"><get name="fecha_evento"/>_<get name="hora_evento"/></map>
                                </set>
                                <addtomap>
                                    <name>evento_persona</name>
                                    <key><get var="fecha_evento_nuevo"/>_<get name="hora_evento"/></key>
                                    <value><get var="contactos"/></value>
                                </addtomap>
                                <!-->Se actualiza la fecha antigua</!-->
                                <set var="listado">
                                    <map name="evento"><get name="fecha_evento"/></map>
                                </set>
                                <set name="nombre_evento">null</set>
                                <set var="listado_antiguo">
                                    <srai>CHANGEITEM <get name="pos_hora"/> BY <get name="nombre_evento"/> IN <get var="listado"/></srai>
                                </set>
                                <modifymap>
                                    <name>evento</name>
                                    <key><get name="fecha_evento"/></key>
                                    <value><get var="listado_antiguo"/></value>
                                </modifymap>
                                <removefrommap>
                                    <name>evento_persona</name>
                                    <key><get name="fecha_evento"/>_<get name="hora_evento"/></key>
                                </removefrommap>

                                <set var="resultado">Evento Modificado</set>
                                <set name="topic">unknown</set>
                            </li>
                            <li>
                                <set var="resultado">Ya existe un evento a esa hora en este dia.</set>
                                <set name="topic">unknown</set>
                            </li>
                        </condition>
                    </li>
                </condition>
            </think>
            <get var="resultado"/>
        </template>
    </category>
    <category>
        <pattern>^ hora ^</pattern>
        <that>DESEA MODIFICAR EL TITULO, LA FECHA, LA HORA, O UN CONTACTO</that>
        <template>Ingresa la nueva hora</template>
    </category>
    <category>
        <pattern>^ contacto ^</pattern>
        <that>DESEA MODIFICAR EL TITULO, LA FECHA, LA HORA, O UN CONTACTO</that>
        <template>Deseas eliminar o agregar un contacto</template>
    </category>
</topic>
</aiml>
